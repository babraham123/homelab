# /etc/containers/systemd/whisper.container
# Ref: https://docs.podman.io/en/latest/markdown/podman-systemd.unit.5.html

[Unit]
Description="Homelab: speech to text transcription"
StartLimitIntervalSec=30
StartLimitBurst=10
Wants=network.target
After=network-online.target

[Container]
Image=localhost/whisper:latest
ContainerName=whisper
AutoUpdate=registry
NoNewPrivileges=true

Network=net.network
HostName=stt.{{ site.url }}
IP={{ websvcs.container_subnet }}.13
# port 10300: Wyoming protocol for stt

PodmanArgs=--gpus=all

Exec="--model={{ model.stt }} --language={{ personal.language.split('-')[0] }}"

Environment=TZ={{ personal.timezone }}
Volume=/var/opt/whisper:/data

[Service]
Restart=on-failure
TimeoutStartSec=300

[Install]
WantedBy=multi-user.target
